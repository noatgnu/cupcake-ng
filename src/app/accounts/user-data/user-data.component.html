<div class="container-fluid p-0" style="height: calc(100vh - 56px); margin-top: 56px;">
  <div class="row h-100 g-0">
    <div class="col-12">
      <div class="container">
        <div class="row g-4">
          <!-- Export Section -->
          <div class="col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-header">
                <h5 class="card-title mb-0">
                  <i class="bi bi-box-arrow-up me-2 text-primary"></i>Export User Data
                </h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <label class="form-label fw-semibold">
                    <i class="bi bi-file-zip me-1"></i>Output Format
                  </label>
                  <select class="form-select" [(ngModel)]="selectedFormat" [disabled]="exportInProgress">
                    <option value="zip">ZIP Archive (.zip)</option>
                    <option value="tar.gz">Compressed Archive (.tar.gz)</option>
                  </select>
                  <div class="form-text">
                    Choose your preferred compression format for the exported data
                  </div>
                </div>

                <div class="d-grid mb-3">
                  <button
                    class="btn btn-primary btn-lg"
                    (click)="exportUserData()"
                    [disabled]="exportInProgress">
                    @if (exportInProgress) {
                      <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                      Exporting Data...
                    } @else {
                      <i class="bi bi-download me-2"></i>
                      Export User Data ({{selectedFormat.toUpperCase()}})
                    }
                  </button>
                </div>

                @if (exportInProgress) {
                  <div class="alert alert-info d-flex align-items-center">
                    <i class="bi bi-info-circle me-2"></i>
                    <div class="flex-grow-1">
                      <strong>Export in Progress</strong>
                      <div class="mt-2">
                        <div class="d-flex justify-content-between mb-1">
                          <small>Progress</small>
                          <small class="fw-bold">{{progress}}%</small>
                        </div>
                        <ngb-progressbar
                          [value]="progress"
                          [max]="100"
                          [type]="'info'"
                          [striped]="true"
                          [animated]="true">
                        </ngb-progressbar>
                      </div>
                    </div>
                  </div>
                }

                @if (downloadReady) {
                  <div class="alert alert-success d-flex align-items-center">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <div class="flex-grow-1">
                      <strong>Export Complete!</strong>
                      <div class="small">Your data is ready for download</div>
                    </div>
                  </div>
                  <div class="d-grid">
                    <button class="btn btn-success btn-lg" (click)="downloadFile()">
                      <i class="bi bi-download me-2"></i>Download {{fileName}}
                    </button>
                  </div>
                }
              </div>
            </div>
          </div>

          <!-- Import Section -->
          <div class="col-lg-6">
            <div class="card shadow-sm h-100">
              <div class="card-header">
                <h5 class="card-title mb-0">
                  <i class="bi bi-box-arrow-in-down me-2 text-success"></i>Import User Data
                </h5>
              </div>
              <div class="card-body">
                <div class="mb-3">
                  <p class="text-muted">
                    <i class="bi bi-info-circle me-1"></i>
                    Upload a previously exported user data file to restore your data
                  </p>
                </div>

                <!-- Import Options -->
                <div class="mb-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <h6 class="fw-semibold mb-0">
                      <i class="bi bi-gear me-1"></i>Import Options
                    </h6>
                    <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#importOptionsCollapse">
                      <i class="bi bi-chevron-down"></i>
                    </button>
                  </div>
                  <div class="collapse show" id="importOptionsCollapse">
                    <div class="mt-2 p-3 rounded">
                      <div class="row g-2">
                        <div class="col-md-6">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="protocols" [(ngModel)]="importOptions.protocols">
                            <label class="form-check-label" for="protocols">
                              <i class="bi bi-file-text me-1"></i>Protocols
                            </label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="sessions" [(ngModel)]="importOptions.sessions">
                            <label class="form-check-label" for="sessions">
                              <i class="bi bi-play-circle me-1"></i>Sessions
                            </label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="annotations" [(ngModel)]="importOptions.annotations">
                            <label class="form-check-label" for="annotations">
                              <i class="bi bi-pencil me-1"></i>Annotations
                            </label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="projects" [(ngModel)]="importOptions.projects">
                            <label class="form-check-label" for="projects">
                              <i class="bi bi-folder me-1"></i>Projects
                            </label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="reagents" [(ngModel)]="importOptions.reagents">
                            <label class="form-check-label" for="reagents">
                              <i class="bi bi-flask me-1"></i>Reagents
                            </label>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="instruments" [(ngModel)]="importOptions.instruments">
                            <label class="form-check-label" for="instruments">
                              <i class="bi bi-cpu me-1"></i>Instruments
                            </label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="lab_groups" [(ngModel)]="importOptions.lab_groups">
                            <label class="form-check-label" for="lab_groups">
                              <i class="bi bi-people me-1"></i>Lab Groups
                            </label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="messaging" [(ngModel)]="importOptions.messaging">
                            <label class="form-check-label" for="messaging">
                              <i class="bi bi-chat me-1"></i>Messaging
                            </label>
                          </div>
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="support_models" [(ngModel)]="importOptions.support_models">
                            <label class="form-check-label" for="support_models">
                              <i class="bi bi-database me-1"></i>Support Models
                            </label>
                          </div>
                        </div>
                      </div>
                      <div class="mt-2">
                        <button class="btn btn-sm btn-outline-primary me-2" (click)="selectAllImportOptions()">
                          <i class="bi bi-check-all me-1"></i>Select All
                        </button>
                        <button class="btn btn-sm btn-outline-secondary" (click)="deselectAllImportOptions()">
                          <i class="bi bi-x me-1"></i>Deselect All
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="d-grid mb-3">
                  <button
                    class="btn btn-success btn-lg"
                    (click)="importFile.click()"
                    [disabled]="chunkUploadProgress > 0 && chunkUploadProgress < chunkUploadTotal">
                    <i class="bi bi-upload me-2"></i>
                    Select Import File
                  </button>
                  <input
                    hidden
                    type="file"
                    #importFile
                    id="importUserData"
                    accept=".zip,.tar.gz,.tar"
                    (change)="importUserData($event)">
                </div>

                @if(chunkUploadProgress > 0 && chunkUploadProgress < chunkUploadTotal) {
                  <div class="alert alert-warning d-flex align-items-center">
                    <i class="bi bi-upload me-2"></i>
                    <div class="flex-grow-1">
                      <strong>Upload in Progress</strong>
                      <div class="mt-2">
                        <div class="d-flex justify-content-between mb-1">
                          <small>Uploading</small>
                          <small class="fw-bold">{{((chunkUploadProgress / chunkUploadTotal) * 100) | number:'1.0-1'}}%</small>
                        </div>
                        <ngb-progressbar
                          [value]="chunkUploadProgress"
                          [max]="chunkUploadTotal"
                          [type]="'warning'"
                          [striped]="true"
                          [animated]="true">
                        </ngb-progressbar>
                      </div>
                    </div>
                  </div>
                } @else if(chunkUploadProgress == chunkUploadTotal && chunkUploadTotal > 0) {
                  <div class="alert alert-success d-flex align-items-center">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    <div>
                      <strong>Upload Complete!</strong>
                      <div class="small">Your data is being processed and imported</div>
                    </div>
                  </div>
                }

                <div class="mt-3">
                  <h6 class="text-muted">Supported Formats</h6>
                  <div class="d-flex gap-2 flex-wrap">
                    <span class="badge bg-secondary">.zip</span>
                    <span class="badge bg-secondary">.tar.gz</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
