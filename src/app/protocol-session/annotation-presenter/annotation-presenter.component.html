<div class="list-group overflow-auto">
  @for (a of annotations; track a.id) {
    <div class="list-group-item border-0">
      <div class="d-flex flex-row justify-content-between flex-wrap">
        <p>
          @if (a.annotation_name) {
            {{a.annotation_name}}
          } @else {
            Untitled Annotation
          }
        </p>
        <div id="annotationControlPanel" class="d-flex flex-row gap-1">

          <button class="btn btn-outline-danger" (click)="scratch(a)"><i class="bi bi-type-strikethrough"></i></button>
          @if (dataService.annotationPermissions[a.id].edit){
            <button class="btn btn-outline-primary" (click)="annotationRename(a)"><i class="bi bi-input-cursor-text"></i></button>
            @if (['audio', 'video'].includes(a.annotation_type)) {
              <button class="btn btn-outline-primary" (click)="openTranscribeModal(a)">Re-transcribe</button>
              <button class="btn btn-outline-primary" (click)="transcriptSummarize(a.id)"><i class="bi bi-body-text"></i></button>
            }
            @if (['sketch'].includes(a.annotation_type)) {
              <button class="btn btn-outline-primary" (click)="ocrAnnotation(a)">OCR</button>
            }
          }
          @if (['counter'].includes(a.annotation_type) && speech.speechRecognition) {
            @if (speech.currentAnnotation === a.id) {
              <button class="btn btn-outline-primary" (click)="forceStop = true;speechRecognition.stop();speech.currentAnnotation=-1"><i class="bi bi-stop"></i></button>
            } @else {
              <button class="btn btn-outline-primary" (click)="startSpeechRecognition(a.id)"><i class="bi bi-record"></i></button>
            }

          }
          @if (['image', 'audio', 'video', 'sketch'].includes(a.annotation_type)) {
            <button class="btn btn-outline-primary" (click)="download(a.id)"><i class="bi bi-download"></i></button>
          }
          @if (dataService.annotationPermissions[a.id].delete){
            <button class="btn btn-outline-danger" (click)="delete(a.id)"><i class="bi bi-trash"></i></button>
          }
        </div>
        <div id="annotationControlPanelDropdown" ngbDropdown class="d-inline-block">
          <button class="btn btn-outline-secondary" id="annotationControlPanelDropdownButton" ngbDropdownToggle><i class="bi bi-three-dots"></i></button>
          <div ngbDropdownMenu aria-labelledby="annotationControlPanelDropdownButton">
            <button class="dropdown-item" (click)="scratch(a)"><i class="bi bi-type-strikethrough"></i> Disable</button>
            @if (dataService.annotationPermissions[a.id].edit){
              <button class="dropdown-item" (click)="annotationRename(a)"><i class="bi bi-input-cursor-text"></i> Rename</button>
              @if (['audio', 'video'].includes(a.annotation_type) && dataService.serverSettings.use_whisper) {
                <button class="dropdown-item" (click)="openTranscribeModal(a)"><i class="bi bi-pencil"></i> Re-transcribe</button>
              }
              @if (['sketch'].includes(a.annotation_type) && dataService.serverSettings.use_ocr) {
                <button class="dropdown-item" (click)="ocrAnnotation(a)"><i class="bi bi-pencil"></i> OCR</button>
              }
            }

            @if (['image', 'audio', 'video', 'sketch'].includes(a.annotation_type)) {
              <button class="dropdown-item" (click)="download(a.id)"><i class="bi bi-download"></i> Download</button>
            }
            @if (dataService.annotationPermissions[a.id].delete){
              <button class="dropdown-item" (click)="delete(a.id)"><i class="bi bi-trash"></i> Delete</button>
            }
          </div>

        </div>
      </div>
      <div class="d-flex flex-row">
        <p>Date: {{a.created_at|date: "short"}} | Annotation Type: {{a.annotation_type}}</p>
      </div>
      <div class="d-flex flex-row">
        <p>Last save: {{a.updated_at|date: "short"}}</p>
      </div>
      @if (a.scratched) {
        <div class="alert alert-secondary mt-2" role="alert">
          This annotation has been disabled
        </div>
      } @else {
        @if (a.annotation_type === 'text') {
          <div [innerHTML]="a.annotation"></div>
        } @else if (a.annotation_type === 'image') {
          <div class="d-flex flex-row justify-content-center">
            <app-image-presenter [annotation]="a"></app-image-presenter>
          </div>
        } @else if (a.annotation_type === 'audio') {
          <div class="d-flex flex-row justify-content-center">
            <app-media-presenter [annotation]="a"></app-media-presenter>
          </div>
        } @else if (a.annotation_type === 'video') {
          <div class="d-flex flex-row justify-content-center">
            <div class="d-flex flex-row justify-content-center">
              <app-media-presenter [annotation]="a"></app-media-presenter>
            </div>
          </div>
        } @else if (a.annotation_type === 'sketch') {
          <div class="d-flex flex-row justify-content-center">
            <app-sketch-presenter [annotation]="a"></app-sketch-presenter>
          </div>
        } @else if (a.annotation_type === 'checklist') {
          <div class="d-flex flex-row justify-content-center">
            <app-checklist-presenter [annotation]="a" (change)="updateAnnotation($event)"></app-checklist-presenter>
          </div>
        } @else if (a.annotation_type === 'counter') {
          <div class="d-flex flex-row justify-content-center">
            <app-counter-presenter [annotation]="a" (change)="updateAnnotation($event)"></app-counter-presenter>
          </div>
        } @else if (a.annotation_type === 'table') {
          <div class="d-flex flex-row justify-content-center">
            <app-table-presenter [annotation]="a" (change)="updateAnnotation($event)"></app-table-presenter>
          </div>
        } @else if (a.annotation_type === 'alignment') {
          <div class="d-flex flex-row justify-content-center">
            <app-alignment-annotation [annotation]="a" (change)="updateAnnotation($event)"></app-alignment-annotation>
          </div>
        } @else if (a.annotation_type === 'calculator') {
          <div class="d-flex flex-row justify-content-center">
            <app-calculator-annotation [annotation]="a" [enableSave]="true" (change)="updateAnnotation($event)"></app-calculator-annotation>
          </div>
        } @else if (a.annotation_type === 'mcalculator') {
          <div class="d-flex flex-row justify-content-center">
            <app-molarity-calculator [annotation]="a" (change)="updateAnnotation($event)"></app-molarity-calculator>
          </div>
        } @else if (a.annotation_type === 'randomization') {
          <div class="d-flex flex-row justify-content-center">
            <app-randomization-presenter [annotation]="a"></app-randomization-presenter>
          </div>
        }
      }


    </div>
  }
</div>
